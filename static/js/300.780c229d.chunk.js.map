{"version":3,"file":"static/js/300.780c229d.chunk.js","mappings":"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","sources":["ocr/ChatInterface.jsx","ocr/ChatInputBox.jsx","ocr/api.ts","ocr/OCRAppV3.jsx"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\n\nconst ChatInterface = ({\n    messages = [],\n    width = '100%',\n    height = '100%'\n}) => {\n    const messagesEndRef = useRef(null);\n\n    // Automatically scroll to the bottom when new messages are added\n    const scrollToBottom = () => {\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    };\n\n    useEffect(() => {\n        scrollToBottom();\n    }, [messages]);\n    \n\n    // Renders the content of a message based on its type ('text' or 'image')\n    const renderMessageContent = (message) => {\n        const { type = 'text', content } = message; // Default to 'text' if type is not specified\n\n        switch (type) {\n            case 'image':\n                return (\n                    <img \n                        src={content} \n                        alt=\"\" \n                        className=\"max-w-xs max-h-60 rounded-md object-cover cursor-pointer transition-transform duration-200 hover:scale-105\"\n                        // You could add an onClick handler here to open a modal with the full image\n                        // onClick={() => onImageClick(content)} \n                    />\n                );\n            case 'text':\n            default:\n                // For text, we wrap it in a <p> tag to ensure consistent styling\n                // This also handles cases where content might already be a React element (though less ideal)\n                if (typeof content === 'string') {\n                    return <p className=\"text-gray-800 text-sm whitespace-pre-line\">{content}</p>;\n                }\n                // return content; // Render as is if it's already an element\n        }\n    };\n\n    // Renders a single message bubble\n    const renderMessage = (message, index) => {\n        const { id, align, avatar, username, timestamp } = message;\n\n        const messageAlignments = {\n            left: (\n                <div className=\"flex items-start space-x-3 mb-4\">\n                    <img src={avatar} alt={username} className=\"w-8 h-8 rounded-full flex-shrink-0\" />\n                    <div className=\"max-w-[70%]\">\n                        <div className=\"flex items-baseline space-x-2 mb-1\">\n                            <span className=\"text-sm font-medium text-gray-700\">{username}</span>\n                            <span className=\"text-xs text-gray-500\">{timestamp}</span>\n                        </div>\n                        <div className=\"bg-white p-3 rounded-lg rounded-tl-none shadow-sm border border-gray-100\">\n                            {renderMessageContent(message)}\n                        </div>\n                    </div>\n                </div>\n            ),\n            right: (\n                <div className=\"flex items-start space-x-3 justify-end mb-4\">\n                    <div className=\"max-w-[70%]\">\n                        <div className=\"flex items-baseline space-x-2 mb-1 justify-end\">\n                            <span className=\"text-xs text-gray-500\">{timestamp}</span>\n                            <span className=\"text-sm font-medium text-gray-700\">{username}</span>\n                        </div>\n                        {/* For images sent by the user, the padding creates a nice frame */}\n                        <div className=\"bg-blue-100 p-2 rounded-lg rounded-tr-none shadow-sm border border-blue-200 inline-block\">\n                            {renderMessageContent(message)}\n                        </div>\n                    </div>\n                    <img src={avatar} alt={username} className=\"w-8 h-8 rounded-full flex-shrink-0\" />\n                </div>\n            ),\n            center: (\n                <div className=\"flex justify-center my-4\">\n                    <div className=\"max-w-[80%] text-center\">\n                        <div className=\"bg-gray-100 px-3 py-2 rounded-lg shadow-sm\">\n                            <span className=\"text-xs text-gray-600 font-medium\">{username}</span>\n                            <span className=\"text-xs text-gray-500 mx-2\">{timestamp}</span>\n                            <div className=\"text-gray-700 text-sm mt-1\">{renderMessageContent(message)}</div>\n                        </div>\n                    </div>\n                </div>\n            )\n        };\n\n        return (\n            <div key={id || index}>\n                {messageAlignments[align] || messageAlignments.left}\n            </div>\n        );\n    };\n\n    return (\n        <div\n            className=\"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden flex flex-col\"\n            style={{ width, height }}\n        >\n            <div\n                className=\"flex-1 overflow-y-auto p-4 bg-gray-50\"\n            >\n                <div className=\"space-y-1\">\n                    {messages.map((message, index) => renderMessage(message, index))}\n                    {/* Add a reference div at the end of the messages for auto-scrolling */}\n                    <div ref={messagesEndRef} />\n                </div>\n                {messages.length === 0 && (\n                    <div className=\"flex items-center justify-center h-full text-gray-500\">\n                        暂无消息\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n};\n\nexport default ChatInterface;","import React, {useState, useRef, useEffect, useCallback} from 'react';\n\nconst ChatInputBox = ({ onSend }) => {\n    const [text, setText] = useState('');\n    const [selectedFile, setSelectedFile] = useState(null);\n    const fileInputRef = useRef(null);\n    const textareaRef = useRef(null);\n\n    // 封装了文本框高度自适应的逻辑 (无变化)\n    const adjustTextareaHeight = useCallback(() => {\n        const textarea = textareaRef.current;\n        if (textarea) {\n            textarea.style.height = 'auto';\n            textarea.style.height = `${textarea.scrollHeight}px`;\n        }\n    }, []);\n\n    // 处理文本输入变化 (无变化)\n    const handleTextChange = (e) => {\n        setText(e.target.value);\n    };\n\n    // 当 text 状态变化后，执行高度调整的副作用 (无变化)\n    useEffect(() => {\n        adjustTextareaHeight();\n    }, [text, adjustTextareaHeight]);\n    \n    // === 新增功能：处理粘贴事件 ===\n    const handlePaste = useCallback((e) => {\n        // 访问剪贴板数据\n        const clipboardItems = e.clipboardData.items;\n        \n        // 遍历剪贴板中的所有项目\n        for (let i = 0; i < clipboardItems.length; i++) {\n            const item = clipboardItems[i];\n            \n            // 检查项目类型是否为图片\n            if (item.type.indexOf('image') !== -1) {\n                // 阻止默认的粘贴行为 (例如，粘贴图片的文件名)\n                e.preventDefault();\n                \n                // 从项目中获取文件对象\n                const file = item.getAsFile();\n                \n                if (file) {\n                    // 如果已经有选中的文件，先移除旧的\n                    if (selectedFile) {\n                        removeSelectedFile();\n                    }\n                    // 设置新粘贴的文件\n                    setSelectedFile(file);\n                }\n                \n                // 找到并处理了第一个图片后，就停止循环\n                break;\n            }\n        }\n    }, [selectedFile]); // 依赖 selectedFile 以便在移除旧文件时有最新状态\n\n\n    // 触发隐藏的文件输入框 (无变化)\n    const handleImageIconClick = () => {\n        fileInputRef.current.click();\n    };\n\n    // 处理文件选择 (无变化)\n    const handleFileChange = (e) => {\n        const file = e.target.files[0];\n        if (file && file.type.startsWith('image/')) {\n            setSelectedFile(file);\n        }\n    };\n    \n    // 移除已选择的文件 (无变化)\n    const removeSelectedFile = () => {\n        setSelectedFile(null);\n        if (fileInputRef.current) {\n            fileInputRef.current.value = '';\n        }\n    }\n\n    // 处理发送逻辑 (无变化，它会自动处理 selectedFile)\n    const handleSend = () => {\n        if (typeof onSend !== 'function') return;\n        let sent = false;\n        if (text.trim()) {\n            onSend({ type: 'text', content: text.trim() });\n            sent = true;\n        }\n        if (selectedFile) {\n            const reader = new FileReader();\n            reader.onload = (e) => {\n                // e.target.result 就是 Base64 编码的字符串\n                onSend({ type: 'image', content: e.target.result, file: selectedFile });\n            };\n            reader.readAsDataURL(selectedFile);\n            sent = true;\n        }\n        if (sent) {\n            setText('');\n            removeSelectedFile();\n        }\n    };\n    \n    // 处理键盘事件 (无变化)\n    const handleKeyPress = (e) => {\n        if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault();\n            handleSend();\n        }\n    };\n\n    const canSend = text.trim() || selectedFile;\n\n    return (\n        <div className=\"p-4 bg-white border-t border-gray-200\">\n            {selectedFile && (\n                <div className=\"relative inline-block mb-2\">\n                    <img src={URL.createObjectURL(selectedFile)} alt=\"Preview\" className=\"w-20 h-20 object-cover rounded-md\"/>\n                    <button onClick={removeSelectedFile} className=\"absolute top-0 right-0 -mt-2 -mr-2 bg-gray-700 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs focus:outline-none\" aria-label=\"Remove image\">&times;</button>\n                </div>\n            )}\n        \n            <div className=\"flex items-end space-x-3\">\n                <textarea\n                    ref={textareaRef}\n                    value={text}\n                    onChange={handleTextChange}\n                    onKeyDown={handleKeyPress}\n                    onPaste={handlePaste} // <<< 在这里绑定粘贴事件处理器\n                    placeholder=\"输入消息或粘贴图片...\"\n                    rows=\"1\"\n                    className=\"flex-1 border border-gray-300 rounded-lg p-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none overflow-y-auto\"\n                    style={{ maxHeight: '120px' }}\n                />\n\n                <div className=\"flex items-center space-x-2\">\n                    <button onClick={handleImageIconClick} className=\"p-2 rounded-full hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-300\" aria-label=\"Select image\">\n                        <svg className=\"w-6 h-6 text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"></path></svg>\n                    </button>\n                    <input type=\"file\" ref={fileInputRef} onChange={handleFileChange} className=\"hidden\" accept=\"image/*\"/>\n                    <button onClick={handleSend} disabled={!canSend} className={`p-2 rounded-full text-white transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${canSend ? 'bg-blue-500 hover:bg-blue-600' : 'bg-gray-300 cursor-not-allowed'}`} aria-label=\"Send message\">\n                        <svg className=\"w-6 h-6\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.428A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z\"></path></svg>\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default ChatInputBox;","const END_POINT = \"https://chat.moonchan.xyz\"\n\nexport async function freeOCR(content: string) {\n    const path = \"/siliconflow/deepseek-ocr\"\n    try {\n        // 构建请求体（根据不同的OCR服务调整结构）[2](@ref)\n        const body = JSON.stringify({\n            image_url: content,        // 多数服务接受纯Base64数据\n            text: \"free ocr.\"\n        });\n\n        // 构建请求头\n        const headers = {\n            'Content-Type': 'application/json',\n        };\n\n        // 发送POST请求[6,8](@ref)\n        const response = await fetch(END_POINT+path, {\n            method: 'POST',\n            headers: headers,\n            body: body\n        });\n\n        // 检查响应状态\n        if (!response.ok) {\n            throw new Error(`OCR API错误: ${response.status} ${response.statusText}`);\n        }\n\n        // 解析并返回JSON结果\n        const result = await response.json();\n        return result.choices[0].message.content;\n\n    } catch (error) {\n        console.error('OCR处理失败:', error);\n        return `${error}`;\n    }\n\n}\n\nexport async function describeImage(content: string) {\n    const path = \"/siliconflow/deepseek-ocr\"\n    try {\n        // 构建请求体（根据不同的OCR服务调整结构）[2](@ref)\n        const body = JSON.stringify({\n            image_url: content,        // 多数服务接受纯Base64数据\n            text: \"describe this image.\"\n        });\n\n        // 构建请求头\n        const headers = {\n            'Content-Type': 'application/json',\n        };\n\n        // 发送POST请求[6,8](@ref)\n        const response = await fetch(END_POINT+path, {\n            method: 'POST',\n            headers: headers,\n            body: body\n        });\n\n        // 检查响应状态\n        if (!response.ok) {\n            throw new Error(`OCR API错误: ${response.status} ${response.statusText}`);\n        }\n\n        // 解析并返回JSON结果\n        const result = await response.json();\n        return result.choices[0].message.content;\n\n    } catch (error) {\n        console.error('OCR处理失败:', error);\n        return `${error}`;\n    }\n\n}\n\nexport async function translateContent(content: string) {\n    const path = \"/siliconflow/GLM-4-9B-0414/translate\"\n    try {\n        // 构建请求头\n        const headers = {\n            'Content-Type': 'application/json',\n        };\n\n        // 发送POST请求[6,8](@ref)\n        const response = await fetch(END_POINT+path, {\n            method: 'POST',\n            headers: headers,\n            body: content\n        });\n\n        // 检查响应状态\n        if (!response.ok) {\n            throw new Error(`translate API错误: ${response.status} ${response.statusText}`);\n        }\n\n        // 解析并返回JSON结果\n        const result = await response.json();\n        return result.choices[0].message.content;\n\n    } catch (error) {\n        console.error('translate处理失败:', error);\n        return `${error}`;\n    }\n\n}","import React, { useState } from 'react';\nimport { useSearchParams } from 'react-router-dom';\nimport ChatInterface from './ChatInterface';\nimport ChatInputBox from './ChatInputBox';\nimport { describeImage, freeOCR, translateContent } from './api.ts'\n// import { time } from 'console';\n\n// ... (假设 ChatInterface 和 ChatInputBox 组件已定义)\n\nconst AVATAR_DEEPSEEK = \"https://upload.moonchan.xyz/api/01LLWEUU4GWGTSADJRMZBYI6XVCRJEV4SA/DeepSeek.svg\";\nconst AVATAR_ZHIPU = \"https://upload.moonchan.xyz/api/01LLWEUU4AXDBVIH7Q2BGJ3E7BU2O7YZSH/zhipu.svg\";\n\nfunction isImageUrl(content) {\n    // 支持的图片后缀名列表\n    const imageExtensions = ['png', 'jpg', 'jpeg', 'gif', 'webp'];\n\n    try {\n        // 使用 URL 对象解析字符串，可以自动分离路径和参数\n        const urlObj = new URL(content);\n        // 获取路径名（例如 '/path/to/image.png'）\n        const pathname = urlObj.pathname;\n        // 获取最后一个点号后的部分作为扩展名，并转换为小写\n        const extension = pathname.split('.').pop().toLowerCase();\n\n        // 检查扩展名是否在列表中\n        return imageExtensions.includes(extension) || true;\n    } catch (error) {\n        // 如果 content 不是有效的完整URL，解析会失败，返回 false\n        return false;\n    }\n}\n\nconst ChatApp = () => {\n\n\n    const [searchParams] = useSearchParams();\n    // 安全的布尔值转换\n    console.log(searchParams)\n    const ocr = searchParams.get('ocr') === 'true';\n    const translate = searchParams.get('translate') === 'true';\n    const describe = searchParams.get('describe') === 'true';\n    const describe_zh = searchParams.get('describe_zh') === 'true';\n\n    const [messages, setMessages] = useState([\n        { id: \"ocr\", align: \"left\", avatar: AVATAR_DEEPSEEK, username: \"free OCR\", content: ocr ? \"OCR 功能开启\" : \"OCR 功能关闭\", timestamp: \"\" },\n        { id: \"translate\", align: \"left\", avatar: AVATAR_ZHIPU, username: \"translate\", content: translate ? \"translate 功能开启\" : \"translate 功能关闭\", timestamp: \"\" },\n        { id: \"describe\", align: \"left\", avatar: AVATAR_DEEPSEEK, username: \"describe\", content: describe ? \"describe 功能开启\" : \"describe 功能关闭\", timestamp: \"\" },\n        { id: \"describe_zh\", align: \"left\", avatar: AVATAR_ZHIPU, username: \"describe 中文\", content: describe_zh ? \"describe 自动翻译功能开启\" : \"describe 自动翻译功能关闭\", timestamp: \"\" },\n    ]);\n\n\n    const handleSendMessage = async (messageData) => {\n        console.log(\"Send message:\", messageData);\n        setMessages((prevMessages) => [\n            ...prevMessages,\n            {\n                id: Date.now(),\n                avatar: \"https://moonchan.xyz/favicon.ico\",\n                username: \"You\",\n                align: \"right\",\n                type: messageData.type,\n                content: messageData.content,\n                timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\n            }])\n        // ... 添加新消息到 messages 状态的逻辑\n        if (messageData.type === \"image\" || (messageData.type === \"text\" && isImageUrl(messageData.content))) {\n            if (ocr || translate) {\n                const result = await freeOCR(messageData.content)\n                console.log(result);\n                if (ocr) setMessages((prevMessages) => [\n                    ...prevMessages,\n                    {\n                        id: Date.now(),\n                        avatar: AVATAR_DEEPSEEK,\n                        username: \"Free OCR\",\n                        align: \"left\",\n                        content: result,\n                        timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\n                    }])\n                if (translate) {\n                    const translated = await translateContent(result);\n                    console.log(translated);\n                    setMessages((prevMessages) => [\n                        ...prevMessages,\n                        {\n                            id: Date.now(),\n                            avatar: AVATAR_ZHIPU,\n                            username: \"Translate\",\n                            align: \"left\",\n                            content: translated,\n                            timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\n                        }])\n                }\n            }\n            if (describe || describe_zh) {\n                const result = await describeImage(messageData.content);\n                console.log(result);\n                if (describe) setMessages((prevMessages) => [\n                    ...prevMessages,\n                    {\n                        id: Date.now(),\n                        avatar: AVATAR_DEEPSEEK,\n                        username: \"Describe\",\n                        align: \"left\",\n                        content: result,\n                        timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\n                    }])\n                if (describe_zh) {\n                    const translated = await translateContent(result);\n                    console.log(translated);\n                    setMessages((prevMessages) => [\n                        ...prevMessages,\n                        {\n                            id: Date.now(),\n                            avatar: AVATAR_ZHIPU,\n                            username: \"Describe\",\n                            align: \"left\",\n                            content: translated,\n                            timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\n                        }])\n                }\n            }\n        }\n    };\n\n    return (\n        // 1. 设置主容器为垂直flex布局，并占满全屏\n        <main className=\"flex flex-col h-screen bg-gray-100\">\n            {/* 2. ChatInterface 包裹器：让它占据所有剩余空间 */}\n            <div className=\"flex-1 min-h-0\">\n                <ChatInterface\n                    messages={messages}\n                    onPageDown={() => { console.log(\"on page down\") }}\n                    onPageUp={() => { console.log(\"on page up\") }}\n                />\n            </div>\n\n            {/* 3. ChatInputBox：高度由其自身内容决定 */}\n            <div>\n                <ChatInputBox onSend={handleSendMessage} />\n            </div>\n        </main>\n    );\n};\n\nexport default ChatApp;"],"names":["_ref","messages","width","height","messagesEndRef","useRef","useEffect","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","renderMessageContent","message","type","content","_jsx","src","alt","className","children","style","_jsxs","map","index","renderMessage","id","align","avatar","username","timestamp","messageAlignments","left","right","center","ref","length","onSend","text","setText","useState","selectedFile","setSelectedFile","fileInputRef","textareaRef","adjustTextareaHeight","useCallback","textarea","scrollHeight","handlePaste","e","clipboardItems","clipboardData","items","i","item","indexOf","preventDefault","file","getAsFile","removeSelectedFile","value","handleSend","sent","trim","reader","FileReader","onload","target","result","readAsDataURL","canSend","URL","createObjectURL","onClick","onChange","onKeyDown","key","shiftKey","onPaste","placeholder","rows","maxHeight","handleImageIconClick","click","fill","stroke","viewBox","xmlns","strokeLinecap","strokeLinejoin","strokeWidth","d","files","startsWith","accept","disabled","END_POINT","async","translateContent","headers","response","fetch","method","body","ok","Error","status","statusText","json","choices","error","console","AVATAR_DEEPSEEK","AVATAR_ZHIPU","ChatApp","searchParams","useSearchParams","log","ocr","get","translate","describe","describe_zh","setMessages","ChatInterface","onPageDown","onPageUp","ChatInputBox","messageData","prevMessages","Date","now","toLocaleTimeString","hour","minute","imageExtensions","extension","pathname","split","pop","toLowerCase","includes","isImageUrl","JSON","stringify","image_url","freeOCR","translated","describeImage"],"sourceRoot":""}