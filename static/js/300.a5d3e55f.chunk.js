"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[300],{2300:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var a=s(5043),n=s(5475),r=s(579);const i=e=>{let{messages:t=[],width:s="100%",height:n="100%"}=e;const i=(0,a.useRef)(null);(0,a.useEffect)((()=>{(()=>{var e;null===(e=i.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})})()}),[t]);const o=e=>{const{type:t="text",content:s}=e;return"image"===t?(0,r.jsx)("img",{src:s,alt:"",className:"max-w-xs max-h-60 rounded-md object-cover cursor-pointer transition-transform duration-200 hover:scale-105"}):"string"===typeof s?(0,r.jsx)("p",{className:"text-gray-800 text-sm whitespace-pre-line",children:s}):void 0};return(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden flex flex-col",style:{width:s,height:n},children:(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[t.map(((e,t)=>((e,t)=>{const{id:s,align:a,avatar:n,username:i,timestamp:l}=e,c={left:(0,r.jsxs)("div",{className:"flex items-start space-x-3 mb-4",children:[(0,r.jsx)("img",{src:n,alt:i,className:"w-8 h-8 rounded-full flex-shrink-0"}),(0,r.jsxs)("div",{className:"max-w-[70%]",children:[(0,r.jsxs)("div",{className:"flex items-baseline space-x-2 mb-1",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:i}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:l})]}),(0,r.jsx)("div",{className:"bg-white p-3 rounded-lg rounded-tl-none shadow-sm border border-gray-100",children:o(e)})]})]}),right:(0,r.jsxs)("div",{className:"flex items-start space-x-3 justify-end mb-4",children:[(0,r.jsxs)("div",{className:"max-w-[70%]",children:[(0,r.jsxs)("div",{className:"flex items-baseline space-x-2 mb-1 justify-end",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500",children:l}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:i})]}),(0,r.jsx)("div",{className:"bg-blue-100 p-2 rounded-lg rounded-tr-none shadow-sm border border-blue-200 inline-block",children:o(e)})]}),(0,r.jsx)("img",{src:n,alt:i,className:"w-8 h-8 rounded-full flex-shrink-0"})]}),center:(0,r.jsx)("div",{className:"flex justify-center my-4",children:(0,r.jsx)("div",{className:"max-w-[80%] text-center",children:(0,r.jsxs)("div",{className:"bg-gray-100 px-3 py-2 rounded-lg shadow-sm",children:[(0,r.jsx)("span",{className:"text-xs text-gray-600 font-medium",children:i}),(0,r.jsx)("span",{className:"text-xs text-gray-500 mx-2",children:l}),(0,r.jsx)("div",{className:"text-gray-700 text-sm mt-1",children:o(e)})]})})})};return(0,r.jsx)("div",{children:c[a]||c.left},s||t)})(e,t))),(0,r.jsx)("div",{ref:i})]}),0===t.length&&(0,r.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500",children:"\u6682\u65e0\u6d88\u606f"})]})})},o=e=>{let{onSend:t}=e;const[s,n]=(0,a.useState)(""),[i,o]=(0,a.useState)(null),l=(0,a.useRef)(null),c=(0,a.useRef)(null),d=(0,a.useCallback)((()=>{const e=c.current;e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)}),[]);(0,a.useEffect)((()=>{d()}),[s,d]);const m=(0,a.useCallback)((e=>{const t=e.clipboardData.items;for(let s=0;s<t.length;s++){const a=t[s];if(-1!==a.type.indexOf("image")){e.preventDefault();const t=a.getAsFile();t&&(i&&u(),o(t));break}}}),[i]),u=()=>{o(null),l.current&&(l.current.value="")},g=()=>{if("function"!==typeof t)return;let e=!1;if(s.trim()&&(t({type:"text",content:s.trim()}),e=!0),i){const s=new FileReader;s.onload=e=>{t({type:"image",content:e.target.result,file:i})},s.readAsDataURL(i),e=!0}e&&(n(""),u())},h=s.trim()||i;return(0,r.jsxs)("div",{className:"p-4 bg-white border-t border-gray-200",children:[i&&(0,r.jsxs)("div",{className:"relative inline-block mb-2",children:[(0,r.jsx)("img",{src:URL.createObjectURL(i),alt:"Preview",className:"w-20 h-20 object-cover rounded-md"}),(0,r.jsx)("button",{onClick:u,className:"absolute top-0 right-0 -mt-2 -mr-2 bg-gray-700 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs focus:outline-none","aria-label":"Remove image",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"flex items-end space-x-3",children:[(0,r.jsx)("textarea",{ref:c,value:s,onChange:e=>{n(e.target.value)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),g())},onPaste:m,placeholder:"\u8f93\u5165\u6d88\u606f\u6216\u7c98\u8d34\u56fe\u7247...",rows:"1",className:"flex-1 border border-gray-300 rounded-lg p-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none overflow-y-auto",style:{maxHeight:"120px"}}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>{l.current.click()},className:"p-2 rounded-full hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-300","aria-label":"Select image",children:(0,r.jsx)("svg",{className:"w-6 h-6 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),(0,r.jsx)("input",{type:"file",ref:l,onChange:e=>{const t=e.target.files[0];t&&t.type.startsWith("image/")&&o(t)},className:"hidden",accept:"image/*"}),(0,r.jsx)("button",{onClick:g,disabled:!h,className:"p-2 rounded-full text-white transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 "+(h?"bg-blue-500 hover:bg-blue-600":"bg-gray-300 cursor-not-allowed"),"aria-label":"Send message",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.428A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})})]})]})]})},l="https://chat.moonchan.xyz";async function c(e){try{const t={"Content-Type":"application/json"},s=await fetch(l+"/siliconflow/qwen2.5-7b-Instruct/translate",{method:"POST",headers:t,body:e});if(!s.ok)throw new Error(`translate API\u9519\u8bef: ${s.status} ${s.statusText}`);return(await s.json()).choices[0].message.content}catch(t){return console.error("translate\u5904\u7406\u5931\u8d25:",t),`${t}`}}const d="https://upload.moonchan.xyz/api/01LLWEUUZ3X77353ZOQBAZFEVAEMZVGU43/image.webp",m="https://upload.moonchan.xyz/api/01LLWEUU4IFRWXLR5X2JF37YR7KICEX7U6/image.webp";const u=()=>{const[e]=(0,n.ok)();console.log(e);const t="true"===e.get("ocr"),s="true"===e.get("translate"),u="true"===e.get("describe"),g="true"===e.get("describe_zh"),[h,x]=(0,a.useState)([{id:"ocr",align:"left",avatar:d,username:"free OCR",content:t?"OCR \u529f\u80fd\u5f00\u542f":"OCR \u529f\u80fd\u5173\u95ed",timestamp:""},{id:"translate",align:"left",avatar:m,username:"translate",content:s?"translate \u529f\u80fd\u5f00\u542f":"translate \u529f\u80fd\u5173\u95ed",timestamp:""},{id:"describe",align:"left",avatar:d,username:"describe",content:u?"describe \u529f\u80fd\u5f00\u542f":"describe \u529f\u80fd\u5173\u95ed",timestamp:""},{id:"describe_zh",align:"left",avatar:m,username:"describe \u4e2d\u6587",content:g?"describe \u81ea\u52a8\u7ffb\u8bd1\u529f\u80fd\u5f00\u542f":"describe \u81ea\u52a8\u7ffb\u8bd1\u529f\u80fd\u5173\u95ed",timestamp:""}]);return(0,r.jsxs)("main",{className:"flex flex-col h-screen bg-gray-100",children:[(0,r.jsx)("div",{className:"flex-1 min-h-0",children:(0,r.jsx)(i,{messages:h,onPageDown:()=>{console.log("on page down")},onPageUp:()=>{console.log("on page up")}})}),(0,r.jsx)("div",{children:(0,r.jsx)(o,{onSend:async e=>{if(console.log("Send message:",e),x((t=>[...t,{id:Date.now(),avatar:"https://moonchan.xyz/favicon.ico",username:"You",align:"right",type:e.type,content:e.content,timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])),"image"===e.type||"text"===e.type&&function(e){const t=["png","jpg","jpeg","gif","webp"];try{const s=new URL(e).pathname.split(".").pop().toLowerCase();return t.includes(s)||!0}catch(s){return!1}}(e.content)){if(t||s){const a=await async function(e){try{const t=JSON.stringify({image_url:e,text:"free ocr."}),s={"Content-Type":"application/json"},a=await fetch(l+"/siliconflow/deepseek-ocr",{method:"POST",headers:s,body:t});if(!a.ok)throw new Error(`OCR API\u9519\u8bef: ${a.status} ${a.statusText}`);return(await a.json()).choices[0].message.content}catch(t){return console.error("OCR\u5904\u7406\u5931\u8d25:",t),`${t}`}}(e.content);if(console.log(a),t&&x((e=>[...e,{id:Date.now(),avatar:d,username:"Free OCR",align:"left",content:a,timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])),s){const e=await c(a);console.log(e),x((t=>[...t,{id:Date.now(),avatar:m,username:"Translate",align:"left",content:e,timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}]))}}if(u||g){const t=await async function(e){try{const t=JSON.stringify({image_url:e,text:"describe this image."}),s={"Content-Type":"application/json"},a=await fetch(l+"/siliconflow/deepseek-ocr",{method:"POST",headers:s,body:t});if(!a.ok)throw new Error(`OCR API\u9519\u8bef: ${a.status} ${a.statusText}`);return(await a.json()).choices[0].message.content}catch(t){return console.error("OCR\u5904\u7406\u5931\u8d25:",t),`${t}`}}(e.content);if(console.log(t),u&&x((e=>[...e,{id:Date.now(),avatar:d,username:"Describe",align:"left",content:t,timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}])),g){const e=await c(t);console.log(e),x((t=>[...t,{id:Date.now(),avatar:m,username:"Describe",align:"left",content:e,timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}]))}}}}})})]})}}}]);
//# sourceMappingURL=300.a5d3e55f.chunk.js.map